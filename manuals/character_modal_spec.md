# キャラクター詳細モーダル仕様書 (2026-01-26時点)

本ドキュメントは、繰り返し発生したレイアウト崩れや仕様の混同を防ぐために定義された、「キャラクター詳細モーダル」の確定仕様である。
今後の改修において、本仕様を逸脱する変更（特に横幅の可変可や、バフ表示の簡略化など）を行う際は慎重に検討すること。

## 1. 基本レイアウト (Layout & Dimensions)

* **コンテナ幅**: **固定 `650px`**
  * **理由**: スキル名の視認性確保（以前の500pxでは見切れたため）およびバフ展開時のレイアウト安定化のため。
  * **モバイル対応**: `max-width: 90vw` を併用。
* **スクロール制御**:
  * `overflow-x: hidden`: コンテンツが幅を超えてもモーダル自体が広がらないように強制。
  * `box-sizing: border-box`: パディングを含めた幅計算。
* **テキスト処理**:
  * すべての説明文・パラメータに対し `overflow-wrap: break-word` (または `anywhere`) を適用し、長い英単語等によるレイアウト破壊を防ぐ。

## 2. ヘッダー領域

* **キャラクター名**: 左側にカラーバーを表示。
* **操作ボタン**:
  * **設定（歯車）**: クリック時、**ポップアップ（コンテキストメニュー）**を表示する。
    * *※インラインで設定項目を展開してはならない（過去の不具合原因）。*
  * **閉じる（×）**: モーダルを閉じる。

## 3. パラメータ表示 (Parameters)

* **形式**: **3列 × 3行 のCSS Grid** (`.char-params-grid`)
* **対象項目**: `['筋力', '生命力', '体格', '精神力', '速度', '直感', '経験', '物理補正', '魔法補正']`
* **デザイン**:
  * 個別のボックス（背景 `#f9f9f9`, ボーダーあり）に格納。
  * **Label** (グレー/太字) : **Value** (黒/太字) の形式で表示。
  * 単なるテキストの羅列（スラッシュ区切りなど）には戻さないこと。

## 4. 特殊効果 / バフ (Buffs)

* **UI構造**: **折りたたみ式 (`<details>`)**
* **デフォルト状態**: 原則として折りたたみ (Closed)。
* **各要素のデザイン**:
  * **ヘッダー (`<summary>`)**:
    * 背景色: 灰色 (`#e9ecef`)
    * 表示内容: **バフ名** + **残りターンバッジ** + **Delayバッジ**
    * **動的バフ名処理**: `_` (アンダーバー) 以降の文字列は内部IDとみなし、表示から除外する。（例: `Bleed_React` → `Bleed`）
  * **詳細ボディ**:
    * 背景色: 白 (`#fff`)
    * **説明文**: 太字の黒文字。
    * **フレーバー**: 斜体のグレー文字。
    * 両者が存在する場合、両方とも表示する。

## 5. スキル (Skills)

* **セクション全体**: **折りたたみ式 (`<details>`)**
* **ヘッダー**:
  * **帯デザイン**: 背景灰色 (`#f8f9fa`)、パディングを広めに確保してクリックしやすくする。
  * **インジケーター**: 右端に「▼」を表示し、開閉可能であることを明示する。
* **リスト表示**: 2列のグリッド表示。
* **GM機能**: ユーザー属性がGMの場合のみ、各スキルに「公開設定」チェックボックスを表示。

## 6. 設定メニュー (Settings Context Menu)

* **表示形式**: `position: absolute` によるポップアップメニュー（ボタン直下に表示）。
* **実装機能**:
    1. **所有権の譲渡**: プルダウン + 実行ボタン。
    2. **駒サイズ**: スライダー (0.5倍 ～ 2.0倍)。
    3. **立ち絵変更**: 青色ボタン（画像ピッカー起動）。
    4. **未配置に戻す**: グレーボタン（確認ダイアログあり）。
    5. **削除**: 赤色ボタン（最下部に配置）。
    6. **GMトグル**: 「GMのみ操作可能」の設定。

## 7. その他 重要コーディング規約

* **イベントリスナー**:
  * モーダル生成時 (`renderCharacterCard`) にHTML文字列として生成し、`openCharacterModal` 内でDOM要素化してからイベントを付与する。
  * 設定メニュー等のイベントは、メニュー生成時に動的に付与し、メモリリークや多重登録（ゾンビイベント）に注意する。

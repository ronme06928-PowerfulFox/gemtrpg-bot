# 戦闘モード機能強化マニュアル (2026-02更新)

本ドキュメントでは、戦闘モードに加えられた主要な機能強化とUI改善について説明します。

## 1. フリー移動システム (Free Movement)

従来のグリッド吸着（マス目移動）を廃止し、より自由な位置取りが可能になりました。

### **特徴**

- **ピクセル単位の配置**: キャラクター駒（トークン）をドラッグ＆ドロップで任意の位置に配置できます。
- **座標の浮動小数点化**: バックエンドシステムを改修し、小数点以下の座標を保持することで、滑らかな移動と位置ズレの防止を実現しました。

### **操作方法**

- **ドラッグ**: 駒を掴んで移動させます。
- **配置**: 目視で任意の位置にドロップします。マス目に強制的に戻されることはありません。

---

## 2. 背景設定機能の統合

戦闘マップの背景画像を、より柔軟に設定できるようになりました。

### **画像ギャラリーとの連携**

- 画面左下の **背景設定ボタン (📷)** から画像ピッカーを開けます。
- **ギャラリータブ**: 探索パートなどでアップロードした背景画像（`type='background'`）が一覧表示され、選択可能です。
- **デフォルト素材**: システムにプリセットされた背景用画像（`static/images/backgrounds` 内）も選択できます。

これにより、探索パートで見せた情緒ある背景をそのまま戦闘シーンにも適用可能です。

---

## 3. キャラクター駒（トークン）のビジュアル刷新

視認性と操作性を向上させるため、トークンのデザインを大幅に刷新しました。

### **基本デザイン**

- **サイズ拡大**: 基本サイズを約1.2倍に拡大し、存在感を強めました。
- **形状の変更**:
  - **上部**: 角丸（フレンドリーな印象）
  - **下部**: 直角（安定感とステータスバーとの親和性）
  - 形状変更により、設置感が向上しました。

### **ステータス表示の改善**

- **HP / MP バー**:
  - トークン下部に配置し、太さと文字サイズを拡大して視認性を向上。
  - 立ち絵（キャラクター画像）を隠さないようレイアウトを調整しました。
- **FP（フォーカスポイント）表示**:
  - 従来のバー表示を廃止し、**左上のオレンジ色の丸いバッジ** として独立させました。
  - これにより、重要なリソースであるFPが一目で確認できます。

### **バッジ（デバフ/状態異常）表示**

- **サイズと位置**:
  - アイコンサイズを調整（34px）し、視認性を確保。
  - **右上に配置**し、数が増えた場合はFPバッジ（左上）との重なりを避けるため、自動的に**2段目（上方向）に折り返す**ロジックを実装しました。

### **手番ハイライト**

- 手番が回ってきたキャラクターは、陣営色に関わらず**背後から金色の光**（Golden Glow）で強調表示されます。

---

## 4. 操作性の改善

- **誤爆防止**: ドラッグ操作後の意図しない「クリック判定」を防止するロジックを強化しました。
- **ターゲティング**: 攻撃対象選択時のハイライト色や挙動を調整し、誰が誰を狙っているかわかりやすくしました。
